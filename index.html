<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Prácticas guiadas – Sesión 4</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  min-height:100vh;
  background:radial-gradient(circle at top,#1a1a1a,#0b0b0b);
  color:#fff;
  font-family:Arial,sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  text-align:center;
}

.logo{margin-top:24px;}
.logo img{width:150px;opacity:.95;}

h1{margin:18px 0 4px;color:#22C55E;}
h2{
  margin:0;
  font-style:italic;
  font-weight:normal;
  font-size:16px;
  color:#a855f7;
}

.menu{
  margin-top:40px;
  display:flex;
  flex-direction:column;
  gap:18px;
}

.menu-btn{
  background:#111;
  border:1.5px solid #22C55E;
  border-radius:16px;
  padding:18px 28px;
  font-size:17px;
  color:#fff;
  cursor:pointer;
  width:320px;
}

.exercise-title{
  margin-top:24px;
  font-size:20px;
  font-weight:600;
}

.rows{margin:28px 0;}
.row{
  display:flex;
  justify-content:space-between;
  width:420px;
  margin:8px auto;
}

.time{
  width:40px;
  font-size:22px;
  opacity:.35;
}
.time.active{opacity:1;transform:scale(1.2);}

.arrow{
  width:40px;
  font-size:32px;
  opacity:.25;
  transition:.1s;
}
.arrow.down{color:#22C55E;}
.arrow.up{color:#a855f7;}
.arrow.active{
  opacity:1;
  transform:scale(1.25);
  text-shadow:0 0 12px currentColor;
}

.controls{margin-top:10px;}
button{
  background:#22C55E;
  color:#000;
  border:none;
  padding:14px 30px;
  font-size:18px;
  border-radius:14px;
  margin:10px;
  cursor:pointer;
}

input[type=range]{width:300px;accent-color:#a855f7;}

.section{display:none;}
.section.active{display:block;}

.info{
  margin-top:26px;
  font-size:14px;
  opacity:.75;
  max-width:420px;
}
</style>
</head>

<body>

<div class="logo">
  <img src="https://static.wixstatic.com/media/b4a607_0927246f3864402c8d6d2d56723b8bba~mv2.png">
</div>

<h1>Prácticas guiadas – Sesión 4</h1>
<h2>El motor ya está en marcha</h2>

<!-- MENÚ -->
<div class="section active" id="menu">
  <div class="menu">
    <button class="menu-btn" onclick="openExercise('basic')">▶ Rasgueo Inicial (Básico)</button>
    <button class="menu-btn" onclick="openExercise('pop')">▶ Rasgueo Pop / Rock</button>
  </div>
</div>

<!-- EJERCICIO -->
<div class="section" id="exercise">
  <div class="exercise-title" id="exerciseName"></div>

  <div class="rows">
    <div class="row" id="times"></div>
    <div class="row" id="arrows"></div>
  </div>

  <div class="controls">
    <button id="play">Play / Stop</button><br><br>
    <input type="range" id="bpm" min="30" max="70" value="40">
    <div>BPM: <span id="bpmVal">40</span></div>
  </div>

  <div class="info" id="infoText"></div>

  <button class="menu-btn" onclick="back()">Volver</button>
</div>

<script>
let audioCtx, downBuffer, upBuffer;
let playing=false, step=0, intervalId=null;
let pattern=[];

/* ===== PATRONES ===== */
const BASIC = {
  name:"Rasgueo Inicial (Básico)",
  info:"↓ en el pulso, ↑ en el “y”.",
  pattern:[
    {l:"1",t:"down",play:true,strong:true},
    {l:"y",t:"up",play:true},
    {l:"2",t:"down",play:true},
    {l:"y",t:"up",play:true},
    {l:"3",t:"down",play:true},
    {l:"y",t:"up",play:true},
    {l:"4",t:"down",play:true},
    {l:"y",t:"up",play:true}
  ]
};

const POP = {
  name:"Rasgueo Pop / Rock",
  info:"En las flechas apagadas las cuerdas quedan sonando. La mano se mueve, pero no toca las cuerdas.",
  pattern:[
    {l:"1",t:"down",play:true,strong:true},
    {l:"y",t:"up",play:false},
    {l:"2",t:"down",play:true,soft:true},
    {l:"y",t:"up",play:true},
    {l:"3",t:"down",play:false},
    {l:"y",t:"up",play:true},
    {l:"4",t:"down",play:true,soft:true},
    {l:"y",t:"up",play:true}
  ]
};

/* ===== VISUAL ===== */
const timesEl=document.getElementById("times");
const arrowsEl=document.getElementById("arrows");
let timeEls=[], arrowEls=[];

function buildVisual(){
  timesEl.innerHTML=""; arrowsEl.innerHTML="";
  timeEls=[]; arrowEls=[];
  pattern.forEach(p=>{
    const t=document.createElement("div");
    t.className="time"; t.textContent=p.l;
    timesEl.appendChild(t); timeEls.push(t);

    const a=document.createElement("div");
    a.className="arrow "+p.t;
    a.textContent=p.t==="down"?"↓":"↑";
    arrowsEl.appendChild(a); arrowEls.push(a);
  });
}

function highlight(i){
  timeEls.forEach(e=>e.classList.remove("active"));
  arrowEls.forEach(e=>e.classList.remove("active"));
  timeEls[i].classList.add("active");
  if(pattern[i].play) arrowEls[i].classList.add("active");
}

/* ===== AUDIO ===== */
async function loadSample(u){
  const r=await fetch(u);
  return await audioCtx.decodeAudioData(await r.arrayBuffer());
}
function playStrum(buf,g){
  const s=audioCtx.createBufferSource();
  const gn=audioCtx.createGain();
  s.buffer=buf;
  const now=audioCtx.currentTime;
  gn.gain.setValueAtTime(0,now);
  gn.gain.linearRampToValueAtTime(g,now+0.004);
  gn.gain.linearRampToValueAtTime(0,now+buf.duration);
  s.connect(gn).connect(audioCtx.destination);
  s.start(now);
}

/* ===== MOTOR ===== */
function tick(){
  const p=pattern[step];
  if(p.play){
    let gain=0.6;
    if(p.strong) gain=0.9;
    if(p.soft) gain=0.55;
    if(p.t==="up") gain=0.45;
    playStrum(p.t==="down"?downBuffer:upBuffer,gain);
  }
  highlight(step);
  step=(step+1)%pattern.length;
}

/* ===== CONTROLES ===== */
const playBtn=document.getElementById("play");
const bpm=document.getElementById("bpm");
const bpmVal=document.getElementById("bpmVal");
bpm.oninput=()=>bpmVal.textContent=bpm.value;

playBtn.onclick=async()=>{
  if(!audioCtx){
    audioCtx=new AudioContext();
    downBuffer=await loadSample("down.wav");
    upBuffer=await loadSample("up.wav");
  }
  if(!playing){
    playing=true; step=0;
    tick();
    intervalId=setInterval(tick,60000/(bpm.value*2));
  }else{
    playing=false; clearInterval(intervalId);
    timeEls.forEach(e=>e.classList.remove("active"));
    arrowEls.forEach(e=>e.classList.remove("active"));
  }
};

/* ===== NAVEGACIÓN ===== */
function openExercise(type){
  playing=false; clearInterval(intervalId);
  document.getElementById("menu").classList.remove("active");
  document.getElementById("exercise").classList.add("active");
  const ex = type==="basic"?BASIC:POP;
  pattern = ex.pattern;
  document.getElementById("exerciseName").textContent = ex.name;
  document.getElementById("infoText").textContent = ex.info;
  buildVisual();
}

function back(){
  playing=false; clearInterval(intervalId);
  document.getElementById("exercise").classList.remove("active");
  document.getElementById("menu").classList.add("active");
}
</script>

</body>
</html>
