<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Zona de Pr√°ctica ‚Äì Sesi√≥n 4 ‚≠ê</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#141414;
  --green:#22C55E;
  --violet:#C9A9FF;
}

body{
  margin:0;
  background:var(--bg);
  color:#fff;
  font-family:Arial,sans-serif;
}

.page{
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding-top:60px;
}

.header{
  display:flex;
  flex-direction:column;
  align-items:center;
  margin-bottom:26px;
}
.header img{ width:150px; margin-bottom:12px; }

h1{ color:var(--green); margin:0; font-weight:600; }
.subtitle{ color:var(--violet); font-style:italic; margin-top:6px; }

.container{ width:100%; max-width:520px; text-align:center; }

.menu-btn{
  width:100%;
  background:#1e1e1e;
  border:1.5px solid var(--green);
  border-radius:14px;
  padding:18px;
  margin:14px 0;
  font-size:16px;
  font-weight:600;
  color:#fff;
  cursor:pointer;
}

.section{ display:none; }

.exercise-title{
  font-size:20px;
  font-weight:600;
  margin-bottom:18px;
}

/* ===== GRILLA ===== */
.rows{ margin:26px 0; }

.row{
  display:flex;
  justify-content:space-between;
  width:420px;
  max-width:90vw;
  margin:6px auto;
}

.time{
  width:40px;
  font-size:22px;
  opacity:.25;
}

.arrow{
  width:40px;
  height:40px;              /* üîí ALTURA FIJA */
  line-height:40px;         /* üîí RESERVA ESPACIO */
  font-size:32px;
  opacity:.15;              /* visible pero ‚Äúapagada‚Äù */
}

.arrow.down{ color:var(--green); }
.arrow.up{ color:var(--violet); }

.active{
  opacity:1;
  transform:scale(1.2);
  text-shadow:0 0 10px currentColor;
}

/* ===== CONTROLES ===== */
.controls{
  margin-top:20px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:16px;
}

button.control{
  background:var(--green);
  color:#000;
  border:none;
  padding:14px 34px;
  font-size:17px;
  border-radius:14px;
  cursor:pointer;
}

button.metro{
  background:#1e1e1e;
  color:#fff;
  border:1.5px solid var(--green);
  padding:12px 30px;
  font-size:15px;
  border-radius:12px;
}
button.metro.active{
  background:var(--green);
  color:#000;
}

input[type=range]{
  width:300px;
  max-width:90vw;
  accent-color:var(--violet);
}

.info{
  margin-top:26px;
  font-size:13px;
  opacity:.7;
}
</style>
</head>

<body>
<div class="page">

<div class="header">
  <img src="https://static.wixstatic.com/media/b4a607_0927246f3864402c8d6d2d56723b8bba~mv2.png">
  <h1>Zona de Pr√°ctica ‚Äì Sesi√≥n 4 ‚≠ê</h1>
  <div class="subtitle">El motor ya est√° en marcha</div>
</div>

<div class="container" id="menu">
  <button class="menu-btn" onclick="openExercise('basic')">‚ñ∂ Rasgueo Inicial (B√°sico)</button>
  <button class="menu-btn" onclick="openExercise('pop')">‚ñ∂ Rasgueo POP / Rock</button>
</div>

<div class="container section" id="exercise">
  <div class="exercise-title" id="exerciseTitle"></div>

  <div class="rows">
    <div class="row" id="times"></div>
    <div class="row" id="arrows"></div>
  </div>

  <div class="controls">
    <button class="control" onclick="togglePlay()">Play / Stop</button>

    <div>
      BPM: <strong><span id="bpmVal">80</span></strong><br>
      <input type="range" min="40" max="90" value="80" id="bpm">
    </div>

    <button class="metro" id="metroBtn" onclick="toggleMetro()">Metr√≥nomo</button>

    <button class="control" onclick="back()">Volver</button>
  </div>
</div>

<div class="info">
Los sonidos no corresponden a ning√∫n acorde.<br>
Son cuerdas al aire usadas solo como referencia r√≠tmica.
</div>

</div>

<script>
let ctx, downBuf, upBuf;
let timer=null, step=0, playing=false;
let metroOn=false;
let currentMap=[];

const GRID=["1","y","2","y","3","y","4","y"];

const BASIC=[
  {t:"down",g:0.9},{t:"up",g:0.5},
  {t:"down",g:0.6},{t:"up",g:0.5},
  {t:"down",g:0.6},{t:"up",g:0.5},
  {t:"down",g:0.6},{t:"up",g:0.5}
];

const POP=[
  {t:"down",g:0.9},null,
  {t:"down",g:0.6},{t:"up",g:0.5},
  null,{t:"up",g:0.25},
  {t:"down",g:0.6},{t:"up",g:0.5}
];

function buildGrid(){
  times.innerHTML="";
  arrows.innerHTML="";
  GRID.forEach(label=>{
    const t=document.createElement("div");
    t.className="time";
    t.textContent=label;
    times.appendChild(t);

    const a=document.createElement("div");
    a.className="arrow";
    a.textContent="‚Üì";       // placeholder invisible
    arrows.appendChild(a);
  });
}

function highlight(i){
  document.querySelectorAll(".time,.arrow").forEach(e=>{
    e.classList.remove("active","down","up");
    if(e.classList.contains("arrow")) e.style.opacity=".15";
  });

  document.querySelectorAll(".time")[i].classList.add("active");

  if(currentMap[i]){
    const a=document.querySelectorAll(".arrow")[i];
    a.textContent=currentMap[i].t==="down"?"‚Üì":"‚Üë";
    a.classList.add("active",currentMap[i].t);
    a.style.opacity="1";
  }
}

async function initAudio(){
  if(!ctx){
    ctx=new AudioContext();
    downBuf=await load("down.wav");
    upBuf=await load("up.wav");
  }
}
async function load(url){
  const r=await fetch(url);
  return await ctx.decodeAudioData(await r.arrayBuffer());
}
function play(buf,g){
  const s=ctx.createBufferSource();
  const gn=ctx.createGain();
  gn.gain.value=g;
  s.buffer=buf;
  s.connect(gn).connect(ctx.destination);
  s.start();
}
function metro(accent){
  if(!metroOn) return;
  const o=ctx.createOscillator();
  const g=ctx.createGain();
  o.frequency.value=accent?1200:700;
  g.gain.value=accent?0.25:0.15;
  o.connect(g).connect(ctx.destination);
  o.start();
  o.stop(ctx.currentTime+0.04);
}

function tick(){
  highlight(step);
  const p=currentMap[step];
  if(p) play(p.t==="down"?downBuf:upBuf,p.g);
  metro(GRID[step]==="1");
  step=(step+1)%8;
}

function togglePlay(){
  if(playing){
    clearInterval(timer);
    playing=false;
    return;
  }
  initAudio();
  step=0;                // üîí SIEMPRE ARRANCA EN 1
  playing=true;
  tick();                // üîí primer golpe inmediato
  const bpm=document.getElementById("bpm").value;
  timer=setInterval(tick,60000/bpm/2);
}

function openExercise(type){
  menu.style.display="none";
  exercise.style.display="block";
  exerciseTitle.textContent =
    type==="basic" ? "Rasgueo Inicial (B√°sico)" : "Rasgueo POP / Rock";
  currentMap = type==="basic"?BASIC:POP;
  buildGrid();
}

function back(){
  clearInterval(timer);
  playing=false;
  exercise.style.display="none";
  menu.style.display="block";
}

function toggleMetro(){
  metroOn=!metroOn;
  metroBtn.classList.toggle("active",metroOn);
}

bpm.oninput=()=>bpmVal.textContent=bpm.value;
</script>

</body>
</html>
