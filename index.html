<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Zona de Pr√°ctica ‚Äì Sesi√≥n 3 ‚≠ê</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#141414;
  --green:#22C55E;
  --green-light:#6aff9c;
  --violet:#C9A9FF;
  --yellow:#E0BA30;
  --orange:orange;
}
body{ margin:0; background:var(--bg); color:#fff; font-family:Arial,sans-serif; }
.page{
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding-top:40px;
  box-sizing:border-box;
}

.header{ display:flex; flex-direction:column; align-items:center; }
.header img{ width:150px; max-width:80%; margin-bottom:12px; }

h1{ color:var(--green); margin:0; font-weight:600; text-align:center; }
.subtitle{ color:var(--violet); font-style:italic; font-size:clamp(14px,4vw,16px); margin:6px 0 24px; }

.container{ max-width:720px; width:100%; padding:16px; text-align:center; box-sizing:border-box; }
.menu-btn{
  width:100%; max-width:420px; background:#1e1e1e;
  border:1.5px solid var(--green); border-radius:12px;
  padding:16px; margin:12px auto; cursor:pointer;
  color:#fff; font-size:16px; font-weight:600;
}
.menu-btn:active{ transform:scale(.97); }

.section{ display:none; }

.circle{ width:150px; height:150px; border-radius:50%; background:#222; margin:32px auto 24px; }
.circle.on{ background:var(--green); }

.controls{ margin:16px auto; max-width:300px; }
input[type=range]{ width:100%; }

button.control{
  background:var(--green); color:#000; border:none; border-radius:12px;
  padding:12px 26px; margin:10px; cursor:pointer;
  font-size:15px; font-weight:600;
}
button.control:active{ transform:scale(.96); }
button.control.playing{ background:var(--green-light); }

button.metro{
  background:#333;
  color:#fff;
  border:1px solid var(--green);
}

button.metro.active{
  background:var(--green);
  color:#000;
}

.progression{ display:flex; justify-content:space-between; margin:20px 0 24px; }
.chord{ flex:1; margin:0 4px; padding:12px 6px; border-radius:10px; background:#222; cursor:pointer; font-size:14px; }
.chord.selected{ outline:2px solid var(--violet); }
.chord.active{ background:var(--green); color:#000; }

.count{ display:flex; justify-content:center; font-size:42px; margin-bottom:20px; }
.count span{ width:36px; opacity:.3; }
.count .one{ color:var(--yellow); opacity:1; }
.count .other{ color:var(--orange); opacity:1; }

@media(max-width:600px){ .count{ font-size:34px; } }
</style>
</head>

<body>
<div class="page">

<div class="header">
  <img src="https://static.wixstatic.com/media/b4a607_0927246f3864402c8d6d2d56723b8bba~mv2.png">
  <h1>Zona de Pr√°ctica ‚Äì Sesi√≥n 3 ‚≠ê</h1>
  <div class="subtitle">Cuando la m√∫sica comienza</div>
</div>

<div class="container section" id="menu" style="display:block">
  <button class="menu-btn" onclick="show('dig1')">‚ñ∂ Digitaci√≥n ‚Äì Ejercicio 1</button>
  <button class="menu-btn" onclick="show('dig2')">‚ñ∂ Digitaci√≥n ‚Äì Ejercicio 2</button>
  <button class="menu-btn" onclick="show('letitbe')">‚ñ∂ Let It Be ‚Äì Pr√°ctica de acordes</button>
</div>

<!-- LET IT BE -->
<div class="container section" id="letitbe">
  <h2>Let It Be ‚Äì Pr√°ctica de acordes</h2>

  <div class="progression">
    <div class="chord">A</div><div class="chord">%</div>
    <div class="chord">E</div><div class="chord">%</div>
    <div class="chord">A</div><div class="chord">%</div>
    <div class="chord">D</div><div class="chord">%</div>
  </div>

  <div class="count">
    <span>1</span><span>2</span><span>3</span><span>4</span>
  </div>

  <div class="controls">
    BPM: <span id="bpmVal">45</span>
    <input type="range" min="45" max="60" value="45" id="bpm">
  </div>

  <button class="control" id="playLet" onclick="toggleLet()">Play / Stop</button>
  <button class="control metro" id="metroBtn" onclick="toggleMetro()">Metr√≥nomo: OFF</button>
  <button class="control" onclick="back()">Volver</button>
</div>

</div>

<script>
/* ===== AUDIO ===== */
let ctx=null;
function ensureAudio(){
  if(!ctx){
    ctx=new (window.AudioContext||window.webkitAudioContext)();
  }
}

function clickSound(vol){
  ensureAudio();
  const o=ctx.createOscillator();
  const g=ctx.createGain();
  o.frequency.value=900;
  g.gain.value=vol;
  o.connect(g); g.connect(ctx.destination);
  o.start(); o.stop(ctx.currentTime+0.05);
}

/* üîî METR√ìNOMO */
let metroOn=false;
function metroSound(accent){
  ensureAudio();
  const o=ctx.createOscillator();
  const g=ctx.createGain();
  o.frequency.value = accent ? 1200 : 700;
  g.gain.value = accent ? 0.25 : 0.15;
  o.connect(g); g.connect(ctx.destination);
  o.start(); o.stop(ctx.currentTime+0.04);
}
function toggleMetro(){
  metroOn=!metroOn;
  metroBtn.textContent = metroOn ? "Metr√≥nomo: ON" : "Metr√≥nomo: OFF";
  metroBtn.classList.toggle("active", metroOn);
}

/* ===== NAVEGACI√ìN ===== */
function show(id){
  stopAll();
  document.querySelectorAll('.section').forEach(s=>s.style.display='none');
  document.getElementById(id).style.display='block';
}
function back(){ stopAll(); show('menu'); }

/* ===== LET IT BE ===== */
const bpm=document.getElementById("bpm");
const bpmVal=document.getElementById("bpmVal");
bpm.oninput=()=>bpmVal.textContent=bpm.value;

const countSpans=document.querySelectorAll(".count span");
const chords=[...document.querySelectorAll(".chord")];
let selectedChord=0;
chords.forEach((c,i)=>{
  c.onclick=()=>{
    chords.forEach(x=>x.classList.remove("selected"));
    c.classList.add("selected"); selectedChord=i;
  };
});

let timer=null, playing=false, beat=0, chordIndex=0;

function highlight(i){
  countSpans.forEach(s=>s.className="");
  if(i===0) countSpans[0].classList.add("one");
  else countSpans[i].classList.add("other");
}

function toggleLet(){
  if(playing){ stopLet(); return; }

  ensureAudio();
  playing=true; playLet.classList.add("playing");
  beat=0; chordIndex=selectedChord;

  const interval=60000/bpm.value;
  timer=setInterval(()=>{
    highlight(beat);

    if(metroOn){
      metroSound(beat===0);
    }

    if(beat===0){
      chords.forEach(c=>c.classList.remove("active"));
      chords[chordIndex].classList.add("active");
      chordIndex=(chordIndex+1)%chords.length;
      clickSound(.3);
    }else{
      clickSound(.15);
    }

    beat=(beat+1)%4;
  }, interval);
}

function stopLet(){
  clearInterval(timer);
  playing=false;
  playLet.classList.remove("playing");
}

function stopAll(){ stopLet(); }
</script>

</body>
</html>
