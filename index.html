<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Zona de Práctica – Sesión 4 ⭐</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#0f0f0f;
  --green:#22C55E;
  --violet:#A855F7;
  --gray:#9ca3af;
}

body{
  margin:0;
  min-height:100vh;
  background:radial-gradient(circle at top,#1a1a1a,#0b0b0b);
  color:#fff;
  font-family:Arial,sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  text-align:center;
}

.logo{ margin-top:20px; }
.logo img{ width:140px; }

h1{
  margin:18px 0 4px;
  color:var(--green);
  font-weight:600;
}

.subtitle{
  color:var(--violet);
  font-style:italic;
  font-size:16px;
  margin-bottom:8px;
}

.exercise{
  margin-top:16px;
  font-size:20px;
  font-weight:600;
}

/* FILAS */
.rows{ margin:28px 0; }

.row{
  display:flex;
  justify-content:space-between;
  width:420px;
  max-width:90vw;
  margin:8px auto;
}

.time{
  width:40px;
  font-size:22px;
  opacity:.35;
  transition:.1s;
}
.time.active{
  opacity:1;
  transform:scale(1.2);
}

.arrow{
  width:40px;
  font-size:32px;
  opacity:.35;
  transition:.1s;
}
.arrow.down{ color:var(--green); }
.arrow.up{ color:var(--violet); }

.arrow.active{
  opacity:1;
  transform:scale(1.25);
  text-shadow:0 0 12px currentColor;
}

/* CONTROLES */
.controls{ margin-top:10px; }

button{
  background:var(--green);
  color:#000;
  border:none;
  padding:14px 30px;
  font-size:18px;
  border-radius:14px;
  margin:10px;
  cursor:pointer;
}
button:active{ transform:scale(.96); }

button.metro{
  background:#222;
  color:#fff;
  border:1px solid var(--green);
}
button.metro.active{
  background:var(--green);
  color:#000;
}

input[type=range]{
  width:300px;
  max-width:90vw;
  accent-color:var(--violet);
}

.info{
  margin-top:26px;
  font-size:14px;
  opacity:.7;
  max-width:420px;
}
</style>
</head>

<body>

<div class="logo">
  <img src="https://static.wixstatic.com/media/b4a607_0927246f3864402c8d6d2d56723b8bba~mv2.png">
</div>

<h1>Zona de Práctica – Sesión 4 ⭐</h1>
<div class="subtitle">El motor ya está en marcha</div>

<div class="exercise">Rasgueo Inicial (Básico)</div>

<div class="rows">
  <div class="row" id="times"></div>
  <div class="row" id="arrows"></div>
</div>

<div class="controls">
  <button id="play">Play / Stop</button><br><br>
  <input type="range" id="bpm" min="30" max="70" value="40">
  <div>BPM: <span id="bpmVal">40</span></div>
  <button class="metro" id="metroBtn">Metrónomo: OFF</button>
</div>

<div class="info">
Los sonidos no corresponden a ningún acorde.<br>
Son cuerdas al aire usadas solo como referencia rítmica.
</div>

<script>
/* ===== AUDIO ===== */
let audioCtx, downBuffer, upBuffer;
let playing=false, step=0, intervalId=null;
let metroOn=false;

const pattern=[
 {l:"1",t:"down",strong:true},
 {l:"y",t:"up"},
 {l:"2",t:"down"},
 {l:"y",t:"up"},
 {l:"3",t:"down"},
 {l:"y",t:"up"},
 {l:"4",t:"down"},
 {l:"y",t:"up"}
];

const GAIN_STRONG=0.9;
const GAIN_DOWN=0.6;
const GAIN_UP=0.45;

const times=document.getElementById("times");
const arrows=document.getElementById("arrows");

pattern.forEach(p=>{
  const t=document.createElement("div");
  t.className="time";
  t.textContent=p.l;
  times.appendChild(t);

  const a=document.createElement("div");
  a.className="arrow "+p.t;
  a.textContent=p.t==="down"?"↓":"↑";
  arrows.appendChild(a);
});

const timeEls=document.querySelectorAll(".time");
const arrowEls=document.querySelectorAll(".arrow");

function highlight(i){
  timeEls.forEach(e=>e.classList.remove("active"));
  arrowEls.forEach(e=>e.classList.remove("active"));
  timeEls[i].classList.add("active");
  arrowEls[i].classList.add("active");
}

async function loadSample(url){
  const r=await fetch(url);
  return await audioCtx.decodeAudioData(await r.arrayBuffer());
}

function playStrum(buffer,gain){
  const src=audioCtx.createBufferSource();
  const g=audioCtx.createGain();
  src.buffer=buffer;

  const now=audioCtx.currentTime;
  g.gain.setValueAtTime(0,now);
  g.gain.linearRampToValueAtTime(gain,now+0.004);
  g.gain.linearRampToValueAtTime(0,now+buffer.duration);

  src.connect(g).connect(audioCtx.destination);
  src.start(now);
}

function metroSound(accent){
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.frequency.value = accent ? 1200 : 700;
  g.gain.value = accent ? 0.25 : 0.15;
  o.connect(g).connect(audioCtx.destination);
  o.start();
  o.stop(audioCtx.currentTime+0.04);
}

function tick(){
  const p=pattern[step];
  const gain = p.strong ? GAIN_STRONG : (p.t==="down"?GAIN_DOWN:GAIN_UP);

  playStrum(p.t==="down"?downBuffer:upBuffer,gain);
  highlight(step);

  if(metroOn){
    metroSound(p.l==="1");
  }

  step=(step+1)%pattern.length;
}

/* CONTROLES */
const playBtn=document.getElementById("play");
const bpmSlider=document.getElementById("bpm");
const bpmVal=document.getElementById("bpmVal");
const metroBtn=document.getElementById("metroBtn");

bpmSlider.oninput=()=>bpmVal.textContent=bpmSlider.value;

metroBtn.onclick=()=>{
  metroOn=!metroOn;
  metroBtn.textContent = metroOn ? "Metrónomo: ON" : "Metrónomo: OFF";
  metroBtn.classList.toggle("active",metroOn);
};

playBtn.onclick=async()=>{
  if(!audioCtx){
    audioCtx=new AudioContext();
    downBuffer=await loadSample("down.wav");
    upBuffer=await loadSample("up.wav");
  }

  if(!playing){
    playing=true;
    step=0;
    tick(); // primer golpe ↓ fuerte
    intervalId=setInterval(tick,60000/(bpmSlider.value*2));
  }else{
    playing=false;
    clearInterval(intervalId);
    timeEls.forEach(e=>e.classList.remove("active"));
    arrowEls.forEach(e=>e.classList.remove("active"));
  }
};
</script>

</body>
</html>
