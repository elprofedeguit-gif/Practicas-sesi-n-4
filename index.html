<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Zona de Práctica – Sesión 4 ⭐</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#141414;
  --green:#22C55E;
  --violet:#C9A9FF;
  --gray:#9ca3af;
}

body{
  margin:0;
  background:var(--bg);
  color:#fff;
  font-family:Arial,sans-serif;
}

.page{
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding-top:24px;
  box-sizing:border-box;
}

.header{
  display:flex;
  flex-direction:column;
  align-items:center;
  margin-bottom:20px;
}

.header img{
  width:150px;
  margin-bottom:10px;
}

h1{
  color:var(--green);
  margin:0;
  font-weight:600;
  text-align:center;
}

.subtitle{
  color:var(--violet);
  font-style:italic;
  font-size:15px;
  margin:6px 0 22px;
}

.container{
  width:100%;
  max-width:520px;
  text-align:center;
}

.menu-btn{
  width:100%;
  background:#1e1e1e;
  border:1.5px solid var(--green);
  border-radius:14px;
  padding:18px;
  margin:14px 0;
  color:#fff;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
}
.menu-btn:active{ transform:scale(.97); }

.section{ display:none; }

/* ===== EJERCICIO ===== */

.exercise-title{
  font-size:20px;
  font-weight:600;
  margin-bottom:18px;
}

.rows{
  margin:26px 0;
}

.row{
  display:flex;
  justify-content:space-between;
  width:420px;
  max-width:90vw;
  margin:6px auto;
}

.time, .arrow{
  width:40px;
  opacity:.35;
  transition:.1s;
}

.time{
  font-size:22px;
}
.arrow{
  font-size:32px;
}

.arrow.down{ color:var(--green); }
.arrow.up{ color:var(--violet); }

.active{
  opacity:1;
  transform:scale(1.25);
  text-shadow:0 0 12px currentColor;
}

.controls{
  margin-top:10px;
}

button.control{
  background:var(--green);
  color:#000;
  border:none;
  padding:14px 30px;
  font-size:17px;
  border-radius:14px;
  margin:10px;
  cursor:pointer;
}
button.control:active{ transform:scale(.96); }

button.metro{
  background:#222;
  color:#fff;
  border:1px solid var(--green);
}
button.metro.active{
  background:var(--green);
  color:#000;
}

input[type=range]{
  width:300px;
  max-width:90vw;
  accent-color:var(--violet);
}

.info{
  margin-top:22px;
  font-size:13px;
  opacity:.7;
}
</style>
</head>

<body>
<div class="page">

<!-- HEADER -->
<div class="header">
  <img src="https://static.wixstatic.com/media/b4a607_0927246f3864402c8d6d2d56723b8bba~mv2.png">
  <h1>Zona de Práctica – Sesión 4 ⭐</h1>
  <div class="subtitle">El motor ya está en marcha</div>
</div>

<!-- MENU -->
<div class="container section" id="menu" style="display:block">
  <button class="menu-btn" onclick="show('basico')">▶ Rasgueo Inicial (Básico)</button>
  <button class="menu-btn" onclick="show('pop')">▶ Rasgueo POP / Rock</button>
</div>

<!-- EJERCICIO BASE -->
<div class="container section" id="basico">
  <div class="exercise-title">Rasgueo Inicial (Básico)</div>
  <div class="rows" id="rows-basico"></div>
  <div class="controls">
    <button class="control" onclick="togglePlay()">Play / Stop</button><br>
    <input type="range" id="bpm" min="30" max="70" value="40">
    <div>BPM: <span id="bpmVal">40</span></div>
    <button class="control metro" id="metroBtn">Metrónomo: OFF</button><br>
    <button class="control" onclick="back()">Volver</button>
  </div>
</div>

<!-- EJERCICIO POP -->
<div class="container section" id="pop">
  <div class="exercise-title">Rasgueo POP / Rock</div>
  <div class="rows" id="rows-pop"></div>
  <div class="controls">
    <button class="control" onclick="togglePlay()">Play / Stop</button><br>
    <input type="range" min="30" max="70" value="60">
    <div>BPM sugerido: 60</div>
    <button class="control" onclick="back()">Volver</button>
  </div>
</div>

<div class="info">
Los sonidos no corresponden a ningún acorde.<br>
Son cuerdas al aire usadas solo como referencia rítmica.
</div>

</div>

<script>
/* ===== AUDIO ===== */
let ctx, downBuf, upBuf;
let playing=false, step=0, timer;
let metroOn=false;

const pattern=[
 {l:"1",t:"down",strong:true},
 {l:"y",t:"up"},
 {l:"2",t:"down"},
 {l:"y",t:"up"},
 {l:"3",t:"down"},
 {l:"y",t:"up"},
 {l:"4",t:"down"},
 {l:"y",t:"up"}
];

function buildRows(id){
  const el=document.getElementById(id);
  el.innerHTML="";
  const row1=document.createElement("div");
  row1.className="row";
  const row2=document.createElement("div");
  row2.className="row";
  pattern.forEach(p=>{
    const t=document.createElement("div");
    t.className="time";
    t.textContent=p.l;
    row1.appendChild(t);

    const a=document.createElement("div");
    a.className="arrow "+p.t;
    a.textContent=p.t==="down"?"↓":"↑";
    row2.appendChild(a);
  });
  el.appendChild(row1);
  el.appendChild(row2);
}
buildRows("rows-basico");
buildRows("rows-pop");

const times=document.querySelectorAll(".time");
const arrows=document.querySelectorAll(".arrow");

function highlight(i){
  times.forEach(e=>e.classList.remove("active"));
  arrows.forEach(e=>e.classList.remove("active"));
  times[i].classList.add("active");
  arrows[i].classList.add("active");
}

async function load(url){
  const r=await fetch(url);
  return await ctx.decodeAudioData(await r.arrayBuffer());
}

function playBuf(buf,g){
  const s=ctx.createBufferSource();
  const gain=ctx.createGain();
  s.buffer=buf;
  gain.gain.value=g;
  s.connect(gain).connect(ctx.destination);
  s.start();
}

function metro(accent){
  const o=ctx.createOscillator();
  const g=ctx.createGain();
  o.frequency.value=accent?1200:700;
  g.gain.value=accent?0.25:0.15;
  o.connect(g).connect(ctx.destination);
  o.start(); o.stop(ctx.currentTime+0.04);
}

function tick(){
  const p=pattern[step];
  playBuf(p.t==="down"?downBuf:upBuf, p.strong?0.9:0.5);
  highlight(step);
  if(metroOn) metro(p.l==="1");
  step=(step+1)%pattern.length;
}

async function togglePlay(){
  if(!ctx){
    ctx=new AudioContext();
    downBuf=await load("down.wav");
    upBuf=await load("up.wav");
  }
  if(!playing){
    playing=true;
    step=0;
    tick();
    timer=setInterval(tick,60000/(document.getElementById("bpm").value*2));
  }else{
    playing=false;
    clearInterval(timer);
  }
}

function show(id){
  document.querySelectorAll(".section").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
}

function back(){
  playing=false;
  clearInterval(timer);
  document.querySelectorAll(".section").forEach(s=>s.style.display="none");
  document.getElementById("menu").style.display="block";
}

document.getElementById("bpm").oninput=e=>{
  document.getElementById("bpmVal").textContent=e.target.value;
};

document.getElementById("metroBtn").onclick=()=>{
  metroOn=!metroOn;
  metroBtn.textContent=metroOn?"Metrónomo: ON":"Metrónomo: OFF";
  metroBtn.classList.toggle("active",metroOn);
};
</script>

</body>
</html>
